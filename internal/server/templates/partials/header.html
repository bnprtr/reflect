<header class="site-header">
  <div class="max-w-7xl mx-auto px-6 lg:px-8 h-full">
    <div class="flex justify-between items-center h-full">
      <div class="flex items-center space-x-4">
        <a href="/" class="flex items-center space-x-3 group">
          <div class="text-2xl font-bold text-gray-900 dark:text-white group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors duration-200">
            Reflect
          </div>
          <div class="hidden sm:block px-3 py-1 text-xs font-medium text-gray-600 dark:text-gray-400 bg-gray-100 dark:bg-slate-700 rounded-full border border-gray-300 dark:border-slate-600">
            Proto Docs
          </div>
        </a>
      </div>

      <div class="flex items-center space-x-3">
        <!-- Search -->
        <div class="relative">
          <div class="relative">
            <input
              type="text"
              id="search-input"
              name="q"
              placeholder="Search services, methods, types..."
              class="w-64 px-3 py-2 pl-10 text-sm bg-white dark:bg-slate-800 border border-gray-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors"
              hx-get="/api/search"
              hx-trigger="keyup changed delay:300ms"
              hx-target="#search-results"
            />
            <svg class="absolute left-3 top-2.5 w-4 h-4 text-gray-400 dark:text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
          </div>
          
          <!-- Search Results Dropdown -->
          <div id="search-results" class="hidden absolute right-0 mt-2 w-80 bg-white dark:bg-slate-800 rounded-lg shadow-xl border-2 border-gray-200 dark:border-slate-700 z-50" style="max-height: 60vh; overflow-y: auto;">
            <!-- Results will be populated here by HTMX -->
          </div>
        </div>

        <!-- Theme Selector -->
        <div class="relative">
          <button id="theme-selector-btn" class="theme-toggle flex items-center space-x-2" aria-label="Select color theme">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01" />
            </svg>
            <span class="hidden sm:inline text-sm font-medium">Theme</span>
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </button>

          <div id="theme-selector-menu" class="hidden absolute right-0 mt-2 w-48 bg-white dark:bg-slate-800 rounded-lg shadow-xl border-2 border-gray-200 dark:border-slate-700 z-50">
            <div class="py-2">
              <button class="theme-option w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-theme="default">
                <span class="font-medium">Default</span>
              </button>
              <button class="theme-option w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-theme="minimal">
                <span class="font-medium">Minimal</span>
              </button>
              <button class="theme-option w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-theme="high-contrast">
                <span class="font-medium">High Contrast</span>
              </button>
              <button class="theme-option w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-theme="ocean">
                <span class="font-medium">Ocean</span>
              </button>
              <button class="theme-option w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-theme="forest">
                <span class="font-medium">Forest</span>
              </button>
              <button class="theme-option w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-theme="sunset">
                <span class="font-medium">Sunset</span>
              </button>
              <button class="theme-option w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-theme="monochrome">
                <span class="font-medium">Monochrome</span>
              </button>
            </div>
          </div>
        </div>

        <!-- Dark Mode Toggle -->
        <button id="theme-toggle" class="theme-toggle" aria-label="Toggle dark mode">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
          </svg>
        </button>
      </div>
    </div>
  </div>
</header>

<script>
// Search functionality
document.addEventListener('DOMContentLoaded', function() {
  const searchInput = document.getElementById('search-input');
  const searchResults = document.getElementById('search-results');

  if (searchInput && searchResults) {
    // Show search results when typing (if query is long enough)
    searchInput.addEventListener('input', function() {
      if (this.value.length >= 2) {
        searchResults.classList.remove('hidden');
      } else {
        searchResults.classList.add('hidden');
      }
    });

    // Hide search results when clicking outside
    document.addEventListener('click', function(event) {
      if (!searchInput.contains(event.target) && !searchResults.contains(event.target)) {
        searchResults.classList.add('hidden');
      }
    });

    // Show dropdown after HTMX loads content
    searchResults.addEventListener('htmx:afterSwap', function(event) {
      if (searchInput.value.length >= 2) {
        searchResults.classList.remove('hidden');
      }
    });

    // Prevent scroll propagation to body when scrolling in dropdown
    searchResults.addEventListener('wheel', function(event) {
      const delta = event.deltaY;
      const scrollTop = this.scrollTop;
      const scrollHeight = this.scrollHeight;
      const height = this.clientHeight;

      // At top and scrolling up
      if (delta < 0 && scrollTop === 0) {
        event.preventDefault();
      }
      // At bottom and scrolling down
      else if (delta > 0 && scrollTop + height >= scrollHeight) {
        event.preventDefault();
      }

      // Otherwise, let the dropdown scroll naturally
      // The event will not propagate to the body
      event.stopPropagation();
    });
  }
});
</script>
